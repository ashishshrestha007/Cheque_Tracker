<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cheque In | ChequeTracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary: #0052CC;
            --primary-hover: #0065FF;
            --primary-light: rgba(0, 82, 204, 0.08);
            --accent: #0065FF;
            --accent-hover: #2684FF;
            --accent-light: rgba(0, 101, 255, 0.1);
            --text-primary: #172B4D;
            --text-secondary: #5E6C84;
            --text-muted: #97A0AF;
            --bg-primary: #FFFFFF;
            --bg-secondary: #F4F5F7;
            --bg-tertiary: #EBECF0;
            --border: #DFE1E6;
            --border-focus: #0052CC;
            --success: #00875A;
            --success-light: rgba(0, 135, 90, 0.1);
            --error: #DE350B;
            --error-light: rgba(222, 53, 11, 0.1);
            --warning: #FF991F;
            --warning-light: rgba(255, 153, 31, 0.1);
            --info: #0065FF;
            --info-light: rgba(0, 101, 255, 0.1);
            --shadow-sm: 0 1px 2px rgba(9, 30, 66, 0.08);
            --shadow-md: 0 4px 8px rgba(9, 30, 66, 0.1);
            --shadow-lg: 0 8px 16px rgba(9, 30, 66, 0.12);
            --shadow-xl: 0 16px 32px rgba(9, 30, 66, 0.15);
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --transition: all 0.2s ease;
            --transition-slow: all 0.3s ease;
            --header-bg: linear-gradient(135deg, #0052CC 0%, #0747A6 100%);
            --sidebar-width: 260px;
        }

        [data-theme="dark"] {
            --primary: #4C9AFF;
            --primary-hover: #79B8FF;
            --primary-light: rgba(76, 154, 255, 0.12);
            --accent: #4C9AFF;
            --accent-hover: #79B8FF;
            --accent-light: rgba(76, 154, 255, 0.12);
            --text-primary: #E6E8EB;
            --text-secondary: #B8C1CC;
            --text-muted: #8C95A0;
            --bg-primary: #161B22;
            --bg-secondary: #0D1117;
            --bg-tertiary: #21262D;
            --border: #30363D;
            --border-focus: #4C9AFF;
            --success-light: rgba(0, 135, 90, 0.2);
            --error-light: rgba(222, 53, 11, 0.2);
            --warning-light: rgba(255, 153, 31, 0.2);
            --info-light: rgba(0, 101, 255, 0.2);
            --header-bg: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            height: 100%;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-secondary);
            min-height: 100vh;
            color: var(--text-primary);
            transition: var(--transition);
            -webkit-font-smoothing: antialiased;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: var(--sidebar-width);
            background: var(--header-bg);
            padding: 24px 0;
            z-index: 100;
            overflow: hidden;
        }

        .sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: radial-gradient(rgba(255,255,255,0.03) 1px, transparent 1px);
            background-size: 20px 20px;
            pointer-events: none;
        }

        .sidebar-shapes {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
            pointer-events: none;
        }

        .sidebar-circle {
            position: absolute;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0.02) 100%);
            border: 1px solid rgba(255,255,255,0.05);
        }

        .sidebar-circle-1 { width: 150px; height: 150px; top: -50px; right: -50px; animation: float1 20s ease-in-out infinite; }
        .sidebar-circle-2 { width: 100px; height: 100px; bottom: 20%; left: -30px; animation: float2 25s ease-in-out infinite; }
        .sidebar-circle-3 { width: 80px; height: 80px; bottom: -20px; right: 20px; animation: float3 18s ease-in-out infinite; }

        @keyframes float1 { 0%, 100% { transform: translate(0, 0); } 50% { transform: translate(-10px, 20px); } }
        @keyframes float2 { 0%, 100% { transform: translate(0, 0); } 50% { transform: translate(20px, -15px); } }
        @keyframes float3 { 0%, 100% { transform: translate(0, 0); } 50% { transform: translate(-15px, -10px); } }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 0 24px;
            margin-bottom: 32px;
            position: relative;
            z-index: 1;
        }

        .sidebar-logo .logo-icon {
            width: 42px;
            height: 42px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar-logo .logo-icon svg {
            width: 22px;
            height: 22px;
            fill: white;
        }

        .sidebar-logo .logo-text {
            display: flex;
            flex-direction: column;
        }

        .sidebar-logo .logo-text span:first-child {
            font-size: 18px;
            font-weight: 700;
            color: white;
            letter-spacing: -0.3px;
        }

        .sidebar-logo .logo-text span:last-child {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .sidebar-nav {
            padding: 0 12px;
            position: relative;
            z-index: 1;
        }

        .nav-section {
            margin-bottom: 24px;
        }

        .nav-section-title {
            font-size: 10px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.4);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            padding: 0 12px;
            margin-bottom: 8px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: var(--radius-md);
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: var(--transition);
            margin-bottom: 4px;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .nav-item.active {
            background: rgba(255, 255, 255, 0.15);
            color: white;
        }

        .nav-item svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
            flex-shrink: 0;
        }

        .nav-item .badge {
            margin-left: auto;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 11px;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 10px;
        }

        .nav-item .badge.alert {
            background: var(--error);
        }

        .sidebar-footer {
            position: absolute;
            bottom: 24px;
            left: 12px;
            right: 12px;
            z-index: 1;
        }

        .sidebar-user {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            margin-bottom: 12px;
        }

        .sidebar-user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #4C9AFF 0%, #00C7E6 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar-user-avatar svg {
            width: 20px;
            height: 20px;
            fill: white;
        }

        .sidebar-user-info {
            flex: 1;
            min-width: 0;
        }

        .sidebar-user-name {
            font-size: 13px;
            font-weight: 600;
            color: white;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sidebar-user-role {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
        }

        .logout-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-md);
            color: rgba(255, 255, 255, 0.8);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            color: white;
        }

        .logout-btn svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }

        /* Main Content */
        .main-wrapper {
            margin-left: var(--sidebar-width);
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border);
            padding: 16px 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .header-left {
            display: flex;
            flex-direction: column;
        }

        .header-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -0.5px;
        }

        .header-subtitle {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .header-datetime {
            text-align: right;
            padding-right: 16px;
            border-right: 1px solid var(--border);
        }

        .header-time {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .header-date {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-btn {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border);
            background: var(--bg-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            position: relative;
        }

        .header-btn:hover {
            background: var(--bg-secondary);
            border-color: var(--text-muted);
        }

        .header-btn svg {
            width: 20px;
            height: 20px;
            fill: var(--text-secondary);
        }

        .theme-toggle .sun { display: none; }
        [data-theme="dark"] .theme-toggle .sun { display: block; }
        [data-theme="dark"] .theme-toggle .moon { display: none; }

        /* Main Content Area */
        .main-content {
            padding: 24px 32px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Quick Stats */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .quick-stat-card {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 16px;
            transition: var(--transition);
        }

        .quick-stat-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .quick-stat-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quick-stat-icon svg {
            width: 24px;
            height: 24px;
            fill: white;
        }

        .quick-stat-icon.blue { background: linear-gradient(135deg, #0052CC, #0747A6); }
        .quick-stat-icon.green { background: linear-gradient(135deg, #00875A, #006644); }
        .quick-stat-icon.orange { background: linear-gradient(135deg, #FF991F, #FF8B00); }
        .quick-stat-icon.purple { background: linear-gradient(135deg, #6554C0, #5243AA); }

        .quick-stat-content h4 {
            font-size: 22px;
            font-weight: 800;
            color: var(--text-primary);
        }

        .quick-stat-content p {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 2px;
        }

        /* Form Container */
        .form-container {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: var(--radius-xl);
            overflow: hidden;
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-header {
            background: linear-gradient(135deg, #0052CC 0%, #0747A6 100%);
            padding: 24px 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .form-header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .form-header-icon {
            width: 52px;
            height: 52px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .form-header-icon svg {
            width: 26px;
            height: 26px;
            fill: white;
        }

        .form-header h2 {
            font-size: 20px;
            font-weight: 700;
            color: white;
        }

        .form-header p {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 4px;
        }

        .form-header-badge {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-header-badge svg {
            width: 16px;
            height: 16px;
            fill: white;
        }

        .form-body {
            padding: 32px;
        }

        /* Django Messages */
        .messages {
            margin-bottom: 24px;
        }

        .alert {
            padding: 16px 20px;
            border-radius: var(--radius-md);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
            font-weight: 500;
        }

        .alert-success {
            background: var(--success-light);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .alert-error {
            background: var(--error-light);
            color: var(--error);
            border: 1px solid var(--error);
        }

        .alert svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        /* Form Sections */
        .form-section {
            margin-bottom: 32px;
        }

        .form-section:last-child {
            margin-bottom: 0;
        }

        .form-section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--border);
        }

        .form-section-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .form-section-icon svg {
            width: 20px;
            height: 20px;
            fill: white;
        }

        .form-section-icon.blue { background: linear-gradient(135deg, #0052CC, #0747A6); }
        .form-section-icon.green { background: linear-gradient(135deg, #00875A, #006644); }
        .form-section-icon.purple { background: linear-gradient(135deg, #6554C0, #5243AA); }
        .form-section-icon.orange { background: linear-gradient(135deg, #FF991F, #FF8B00); }

        .form-section-title h3 {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .form-section-title p {
            font-size: 13px;
            color: var(--text-muted);
            margin-top: 2px;
        }

        /* Form Grid */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-label .required {
            color: var(--error);
            font-weight: 700;
        }

        .form-label .optional {
            font-size: 11px;
            font-weight: 400;
            color: var(--text-muted);
        }

        /* Input Styles */
        .input-wrapper {
            position: relative;
        }

        .input-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            fill: var(--text-muted);
            pointer-events: none;
            transition: var(--transition);
        }

        .input-wrapper.has-icon input,
        .input-wrapper.has-icon select {
            padding-left: 48px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            height: 52px;
            padding: 0 16px;
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: var(--radius-md);
            font-family: inherit;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            transition: var(--transition);
            outline: none;
        }

        .form-textarea {
            height: auto;
            min-height: 100px;
            padding: 16px;
            resize: vertical;
        }

        .form-input::placeholder,
        .form-textarea::placeholder {
            color: var(--text-muted);
            font-weight: 400;
        }

        .form-input:hover,
        .form-select:hover,
        .form-textarea:hover {
            border-color: var(--text-muted);
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px var(--primary-light);
        }

        .input-wrapper:focus-within .input-icon {
            fill: var(--primary);
        }

        /* Date Input */
        .date-input-wrapper {
            position: relative;
        }

        .date-input-wrapper .form-input {
            padding-right: 48px;
            cursor: pointer;
        }

        .date-input-wrapper input[type="date"]::-webkit-calendar-picker-indicator {
            position: absolute;
            right: 0;
            top: 0;
            width: 48px;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .date-icon {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            fill: var(--text-muted);
            pointer-events: none;
            transition: var(--transition);
        }

        .date-input-wrapper:focus-within .date-icon {
            fill: var(--primary);
        }

        /* Select Styles */
        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%2397A0AF'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 24px;
            padding-right: 44px;
            cursor: pointer;
        }

        /* Amount Input */
        .amount-input-wrapper {
            position: relative;
        }

        .amount-prefix {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
            font-weight: 700;
            color: var(--text-muted);
            transition: var(--transition);
        }

        .amount-input-wrapper .form-input {
            padding-left: 60px;
            font-size: 18px;
            font-weight: 700;
        }

        .amount-input-wrapper:focus-within .amount-prefix {
            color: var(--primary);
        }

        /* Amount in Words Display */
        .amount-words-display {
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--accent-light) 100%);
            border: 2px solid var(--primary);
            border-radius: var(--radius-md);
            padding: 16px 20px;
            min-height: 52px;
            display: flex;
            align-items: center;
        }

        .amount-words-display .label {
            font-size: 11px;
            font-weight: 600;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .amount-words-display .words {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            text-transform: capitalize;
        }

        .amount-words-display .placeholder {
            font-size: 14px;
            font-weight: 400;
            color: var(--text-muted);
            font-style: italic;
        }

        /* Input Help Text */
        .input-help {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 6px;
        }

        .input-help svg {
            width: 14px;
            height: 14px;
            fill: currentColor;
            flex-shrink: 0;
        }

        .input-help.highlight {
            color: var(--primary);
            background: var(--primary-light);
            padding: 8px 12px;
            border-radius: var(--radius-sm);
            margin-top: 8px;
        }

        /* Transfer Info Box */
        .transfer-info-box {
            background: linear-gradient(135deg, var(--success-light) 0%, rgba(0, 135, 90, 0.05) 100%);
            border: 2px dashed var(--success);
            border-radius: var(--radius-md);
            padding: 16px 20px;
            margin-top: 24px;
        }

        .transfer-info-box .transfer-label {
            font-size: 11px;
            font-weight: 700;
            color: var(--success);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .transfer-info-box .transfer-label svg {
            width: 16px;
            height: 16px;
            fill: var(--success);
        }

        .transfer-info-box .transfer-flow {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .transfer-info-box .transfer-party {
            flex: 1;
            min-width: 200px;
            background: var(--bg-primary);
            padding: 12px 16px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
        }

        .transfer-info-box .transfer-party-label {
            font-size: 10px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .transfer-info-box .transfer-party-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-top: 4px;
        }

        .transfer-info-box .transfer-arrow {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: var(--success);
            border-radius: 50%;
            flex-shrink: 0;
        }

        .transfer-info-box .transfer-arrow svg {
            width: 20px;
            height: 20px;
            fill: white;
        }

        /* Form Actions */
        .form-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 24px 32px;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border);
        }

        .form-footer-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .form-footer-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            height: 48px;
            padding: 0 24px;
            border-radius: var(--radius-md);
            font-family: inherit;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
            text-decoration: none;
        }

        .btn svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 82, 204, 0.4);
        }

        .btn-secondary {
            background: var(--bg-primary);
            border-color: var(--border);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--bg-secondary);
            border-color: var(--text-muted);
        }

        .btn-success {
            background: linear-gradient(135deg, #00875A 0%, #006644 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 135, 90, 0.4);
        }

        .btn-ghost {
            background: transparent;
            color: var(--text-secondary);
        }

        .btn-ghost:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .btn-lg {
            height: 56px;
            padding: 0 32px;
            font-size: 16px;
            border-radius: var(--radius-lg);
        }

        .btn-excel {
            background: linear-gradient(135deg, #217346 0%, #185C37 100%);
            color: white;
        }

        .btn-excel:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 115, 70, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #DE350B 0%, #BF2600 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(222, 53, 11, 0.4);
        }

        /* Recent Entries Table */
        .recent-entries {
            margin-top: 24px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: var(--radius-xl);
            overflow: hidden;
        }

        .recent-entries-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
        }

        .recent-entries-header h3 {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .recent-entries-header h3 .count {
            background: var(--primary-light);
            color: var(--primary);
            font-size: 12px;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 12px;
        }

        .table-wrapper {
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            padding: 14px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .data-table th {
            background: var(--bg-secondary);
            font-size: 11px;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .data-table td {
            font-size: 13px;
            color: var(--text-primary);
        }

        .data-table tbody tr:hover {
            background: var(--bg-secondary);
        }

        .data-table tbody tr:last-child td {
            border-bottom: none;
        }

        .table-cheque-no {
            font-weight: 600;
            color: var(--primary);
        }

        .table-amount {
            font-weight: 700;
            color: var(--success);
        }

        .table-date {
            color: var(--text-secondary);
            font-size: 12px;
        }

        .table-party {
            max-width: 150px;
        }

        .table-party-name {
            font-weight: 500;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .table-party-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .table-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }

        .table-status.pending {
            background: var(--warning-light);
            color: var(--warning);
        }

        .table-status.cleared {
            background: var(--success-light);
            color: var(--success);
        }

        .table-status.processing {
            background: var(--primary-light);
            color: var(--primary);
        }

        .table-status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
        }

        .table-actions {
            display: flex;
            gap: 8px;
        }

        .table-action-btn {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            background: var(--bg-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            text-decoration: none;
        }

        .table-action-btn:hover {
            background: var(--bg-secondary);
            border-color: var(--text-muted);
        }

        .table-action-btn svg {
            width: 16px;
            height: 16px;
            fill: var(--text-muted);
        }

        .table-action-btn:hover svg {
            fill: var(--text-primary);
        }

        .table-action-btn.edit:hover {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .table-action-btn.edit:hover svg {
            fill: var(--primary);
        }

        .table-action-btn.delete-btn:hover {
            border-color: var(--error);
            background: var(--error-light);
        }

        .table-action-btn.delete-btn:hover svg {
            fill: var(--error);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-primary);
            border-radius: var(--radius-xl);
            padding: 32px;
            max-width: 400px;
            width: 90%;
        }

        .modal-icon {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: var(--error-light);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
        }

        .modal-icon svg {
            width: 32px;
            height: 32px;
            fill: var(--error);
        }

        .modal-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            text-align: center;
            margin-bottom: 8px;
        }

        .modal-message {
            font-size: 14px;
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 24px;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
        }

        .modal-actions .btn {
            flex: 1;
        }

        /* Edit Mode Banner */
        .edit-mode-banner {
            background: linear-gradient(135deg, var(--warning-light), rgba(255, 153, 31, 0.2));
            border: 2px solid var(--warning);
            border-radius: var(--radius-md);
            padding: 12px 20px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .edit-mode-banner svg {
            width: 24px;
            height: 24px;
            fill: var(--warning);
        }

        .edit-mode-banner-content { flex: 1; }

        .edit-mode-banner-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .edit-mode-banner-subtitle {
            font-size: 12px;
            color: var(--text-muted);
        }

        .edit-mode-banner .btn {
            height: 36px;
            padding: 0 16px;
            font-size: 12px;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .quick-stats { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 1024px) {
            .sidebar { transform: translateX(-100%); }
            .main-wrapper { margin-left: 0; }
        }

        @media (max-width: 768px) {
            .header { padding: 12px 16px; }
            .header-datetime { display: none; }
            .main-content { padding: 16px; }
            .form-grid { grid-template-columns: 1fr; }
            .quick-stats { grid-template-columns: 1fr; }
            .form-footer { flex-direction: column; gap: 16px; }
            .form-footer-left, .form-footer-right { width: 100%; justify-content: center; }
            .btn { flex: 1; }
            .form-header { flex-direction: column; gap: 16px; text-align: center; }
            .form-header-left { flex-direction: column; }
            .transfer-info-box .transfer-flow { flex-direction: column; }
            .transfer-info-box .transfer-arrow { transform: rotate(90deg); }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-shapes">
            <div class="sidebar-circle sidebar-circle-1"></div>
            <div class="sidebar-circle sidebar-circle-2"></div>
            <div class="sidebar-circle sidebar-circle-3"></div>
        </div>

        <div class="sidebar-logo">
            <div class="logo-icon">
                <svg viewBox="0 0 24 24">
                    <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
                </svg>
            </div>
            <div class="logo-text">
                <span>ChequeTracker</span>
                <span>Management</span>
            </div>
        </div>

        <nav class="sidebar-nav">
            <div class="nav-section">
                <div class="nav-section-title">Main Menu</div>
                <a href="{% url 'dashboard' %}" class="nav-item">
                    <svg viewBox="0 0 24 24"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/></svg>
                    Dashboard
                </a>
                <a href="{% url 'cheque' %}" class="nav-item active">
                    <svg viewBox="0 0 24 24"><path d="M19 14V6c0-1.1-.9-2-2-2H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zm-9-1c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm13-6v11c0 1.1-.9 2-2 2H4v-2h17V7h2z"/></svg>
                    Cheque In
                    <span class="badge alert" id="pendingBadge">{{ pending_count }}</span>
                </a>
                <a href="{% url 'deposit' %}" class="nav-item">
                    <svg viewBox="0 0 24 24"><path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/></svg>
                    Deposit
                </a>
                <a href="{% url 'report' %}" class="nav-item">
                    <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/></svg>
                    Reports
                </a>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Settings</div>
                <a href="{% url 'setting' %}" class="nav-item">
                    <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
                    Settings
                </a>
                <a href="{% url 'help' %}" class="nav-item">
                    <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
                    Help & Support
                </a>
            </div>
        </nav>

        <div class="sidebar-footer">
            <div class="sidebar-user">
                <div class="sidebar-user-avatar">
                    <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                </div>
                <div class="sidebar-user-info">
                    <div class="sidebar-user-name">John Doe</div>
                    <div class="sidebar-user-role">Administrator</div>
                </div>
            </div>
            <a href="{% url 'logout' %}" class="logout-btn">
                <svg viewBox="0 0 24 24"><path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/></svg>
                Sign Out
            </a>
        </div>
    </aside>

    <!-- Main Wrapper -->
    <div class="main-wrapper">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1 class="header-title">Cheque In</h1>
                <p class="header-subtitle">Submit and process new cheques for verification</p>
            </div>
            <div class="header-right">
                <div class="header-datetime">
                    <div class="header-time" id="currentTime">00:00</div>
                    <div class="header-date" id="currentDate">Loading...</div>
                </div>
                <div class="header-actions">
                    <button class="header-btn theme-toggle" onclick="toggleTheme()" title="Toggle Theme">
                        <svg class="moon" viewBox="0 0 24 24"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/></svg>
                        <svg class="sun" viewBox="0 0 24 24"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"/></svg>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Django Messages -->
            {% if messages %}
            <div class="messages">
                {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    <svg viewBox="0 0 24 24">
                        {% if message.tags == 'success' %}
                        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                        {% else %}
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                        {% endif %}
                    </svg>
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Quick Stats -->
            <div class="quick-stats">
                <div class="quick-stat-card">
                    <div class="quick-stat-icon blue">
                        <svg viewBox="0 0 24 24"><path d="M19 14V6c0-1.1-.9-2-2-2H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zm-9-1c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm13-6v11c0 1.1-.9 2-2 2H4v-2h17V7h2z"/></svg>
                    </div>
                    <div class="quick-stat-content">
                        <h4>{{ today_count }}</h4>
                        <p>Today's Cheques</p>
                    </div>
                </div>
                <div class="quick-stat-card">
                    <div class="quick-stat-icon green">
                        <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
                    </div>
                    <div class="quick-stat-content">
                        <h4>{{ cleared_count }}</h4>
                        <p>Cleared</p>
                    </div>
                </div>
                <div class="quick-stat-card">
                    <div class="quick-stat-icon orange">
                        <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
                    </div>
                    <div class="quick-stat-content">
                        <h4>{{ pending_count }}</h4>
                        <p>Pending</p>
                    </div>
                </div>
                <div class="quick-stat-card">
                    <div class="quick-stat-icon purple">
                        <svg viewBox="0 0 24 24"><path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/></svg>
                    </div>
                    <div class="quick-stat-content">
                        <h4>NPR {{ total_amount|floatformat:2 }}</h4>
                        <p>Total Amount</p>
                    </div>
                </div>
            </div>

            <!-- Form Container -->
            <div class="form-container">
                <div class="form-header">
                    <div class="form-header-left">
                        <div class="form-header-icon">
                            <svg viewBox="0 0 24 24"><path d="M19 14V6c0-1.1-.9-2-2-2H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zm-9-1c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm13-6v11c0 1.1-.9 2-2 2H4v-2h17V7h2z"/></svg>
                        </div>
                        <div>
                            <h2>{% if edit_mode %}Edit Cheque Entry{% else %}New Cheque Entry{% endif %}</h2>
                            <p>{% if edit_mode %}Update the cheque details below{% else %}Fill in the cheque details below to submit{% endif %}</p>
                        </div>
                    </div>
                    <div class="form-header-badge">
                        <svg viewBox="0 0 24 24"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>
                        <span id="formTime">--:--</span>
                    </div>
                </div>

                <form id="chequeForm" class="form-body" method="POST" action="{% if edit_mode %}{% url 'cheque_edit' edit_cheque.id %}{% else %}{% url 'cheque' %}{% endif %}">
                    {% csrf_token %}
                    
                    <!-- Edit Mode Banner -->
                    {% if edit_mode %}
                    <div class="edit-mode-banner">
                        <svg viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
                        <div class="edit-mode-banner-content">
                            <div class="edit-mode-banner-title">Editing Cheque #{{ edit_cheque.cheque_number }}</div>
                            <div class="edit-mode-banner-subtitle">Make changes and click Update to save</div>
                        </div>
                        <a href="{% url 'cheque' %}" class="btn btn-secondary">Cancel Edit</a>
                    </div>
                    {% endif %}
                    
                    <!-- Cheque Details Section -->
                    <div class="form-section">
                        <div class="form-section-header">
                            <div class="form-section-icon blue">
                                <svg viewBox="0 0 24 24"><path d="M19 14V6c0-1.1-.9-2-2-2H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zm-9-1c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3z"/></svg>
                            </div>
                            <div class="form-section-title">
                                <h3>Cheque Details</h3>
                                <p>Enter the information from the cheque</p>
                            </div>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Cheque Number <span class="required">*</span></label>
                                <div class="input-wrapper has-icon">
                                    <input type="text" class="form-input" id="chequeNo" placeholder="e.g., 000123456" name="cheque_no" value="{% if edit_mode %}{{ edit_cheque.cheque_number }}{% endif %}" required>
                                    <svg class="input-icon" viewBox="0 0 24 24"><path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"/></svg>
                                </div>
                                <span class="input-help">
                                    <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
                                    The cheque number printed at the bottom
                                </span>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Cheque Date <span class="required">*</span></label>
                                <div class="date-input-wrapper">
                                    <input type="date" class="form-input" id="chequeDate" name="cheque_date" value="{% if edit_mode %}{{ edit_cheque.cheque_date|date:'Y-m-d' }}{% endif %}" required>
                                    <svg class="date-icon" viewBox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM9 10H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm-8 4H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z"/></svg>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Cheque Bank <span class="required">*</span></label>
                                <div class="input-wrapper has-icon">
                                    <select class="form-select" id="chequeBank" name="cheque_bank" required>
                                        <option value="">Select cheque bank</option>
                                        <optgroup label="Class A - Commercial Banks">
                                            <option value="Nabil Bank" {% if edit_mode and edit_cheque.cheque_bank == 'Nabil Bank' %}selected{% endif %}>Nabil Bank Limited</option>
                                            <option value="Nepal Investment Mega Bank" {% if edit_mode and edit_cheque.cheque_bank == 'Nepal Investment Mega Bank' %}selected{% endif %}>Nepal Investment Mega Bank Limited</option>
                                            <option value="Standard Chartered Bank" {% if edit_mode and edit_cheque.cheque_bank == 'Standard Chartered Bank' %}selected{% endif %}>Standard Chartered Bank Nepal Limited</option>
                                            <option value="Himalayan Bank" {% if edit_mode and edit_cheque.cheque_bank == 'Himalayan Bank' %}selected{% endif %}>Himalayan Bank Limited</option>
                                            <option value="Nepal SBI Bank" {% if edit_mode and edit_cheque.cheque_bank == 'Nepal SBI Bank' %}selected{% endif %}>Nepal SBI Bank Limited</option>
                                            <option value="Nepal Bank" {% if edit_mode and edit_cheque.cheque_bank == 'Nepal Bank' %}selected{% endif %}>Nepal Bank Limited</option>
                                            <option value="Rastriya Banijya Bank" {% if edit_mode and edit_cheque.cheque_bank == 'Rastriya Banijya Bank' %}selected{% endif %}>Rastriya Banijya Bank Limited</option>
                                            <option value="Everest Bank" {% if edit_mode and edit_cheque.cheque_bank == 'Everest Bank' %}selected{% endif %}>Everest Bank Limited</option>
                                            <option value="NIC Asia Bank" {% if edit_mode and edit_cheque.cheque_bank == 'NIC Asia Bank' %}selected{% endif %}>NIC Asia Bank Limited</option>
                                            <option value="Global IME Bank" {% if edit_mode and edit_cheque.cheque_bank == 'Global IME Bank' %}selected{% endif %}>Global IME Bank Limited</option>
                                            <option value="Sanima Bank" {% if edit_mode and edit_cheque.cheque_bank == 'Sanima Bank' %}selected{% endif %}>Sanima Bank Limited</option>
                                            <option value="Prabhu Bank" {% if edit_mode and edit_cheque.cheque_bank == 'Prabhu Bank' %}selected{% endif %}>Prabhu Bank Limited</option>
                                            <option value="NMB Bank" {% if edit_mode and edit_cheque.cheque_bank == 'NMB Bank' %}selected{% endif %}>NMB Bank Limited</option>
                                        </optgroup>
                                        <option value="Other" {% if edit_mode and edit_cheque.cheque_bank == 'Other' %}selected{% endif %}>Other Bank</option>
                                    </select>
                                    <svg class="input-icon" viewBox="0 0 24 24"><path d="M4 10h3v7H4zm6 0h3v7h-3zm-8 9h19v3H2zm14-9h3v7h-3zm-4.5-9L2 6v2h19V6z"/></svg>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Drawer / Issued By <span class="required">*</span></label>
                                <div class="input-wrapper has-icon">
                                    <input type="text" class="form-input" id="accountName" placeholder="Who wrote/issued the cheque" name="account_name" value="{% if edit_mode %}{{ edit_cheque.account_name }}{% endif %}" required>
                                    <svg class="input-icon" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                                </div>
                                <span class="input-help">
                                    <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
                                    The person/company who wrote this cheque (money goes FROM)
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Payee / Beneficiary Section -->
                    <div class="form-section">
                        <div class="form-section-header">
                            <div class="form-section-icon orange">
                                <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
                            </div>
                            <div class="form-section-title">
                                <h3>Payee / Beneficiary</h3>
                                <p>Who is receiving the money from this cheque</p>
                            </div>
                        </div>

                        <div class="form-grid">
                            <div class="form-group full-width">
                                <label class="form-label">Payee Name / Pay To <span class="required">*</span></label>
                                <div class="input-wrapper has-icon">
                                    <input type="text" class="form-input" id="payeeName" placeholder="e.g., Pioneer Software Pvt. Ltd." name="payee_name" value="{% if edit_mode %}{{ edit_cheque.payee_name }}{% endif %}" required>
                                    <svg class="input-icon" viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
                                </div>
                                <span class="input-help highlight">
                                    <svg viewBox="0 0 24 24"><path d="M11 17h2v-6h-2v6zm1-15C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 9h2V7h-2v2z"/></svg>
                                    Your company name or the person receiving the payment (money goes TO)
                                </span>
                            </div>
                        </div>

                        <!-- Transfer Flow Visualization -->
                        <div class="transfer-info-box" id="transferInfoBox" style="{% if not edit_mode %}display: none;{% endif %}">
                            <div class="transfer-label">
                                <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
                                Transaction Flow Preview
                            </div>
                            <div class="transfer-flow">
                                <div class="transfer-party">
                                    <div class="transfer-party-label">From (Drawer)</div>
                                    <div class="transfer-party-name" id="previewDrawer">{% if edit_mode %}{{ edit_cheque.account_name }}{% else %}-{% endif %}</div>
                                </div>
                                <div class="transfer-arrow">
                                    <svg viewBox="0 0 24 24"><path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"/></svg>
                                </div>
                                <div class="transfer-party">
                                    <div class="transfer-party-label">To (Payee)</div>
                                    <div class="transfer-party-name" id="previewPayee">{% if edit_mode %}{{ edit_cheque.payee_name }}{% else %}-{% endif %}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Amount Section -->
                    <div class="form-section">
                        <div class="form-section-header">
                            <div class="form-section-icon green">
                                <svg viewBox="0 0 24 24"><path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/></svg>
                            </div>
                            <div class="form-section-title">
                                <h3>Cheque Amount</h3>
                                <p>Enter the amount and it will be converted to words automatically</p>
                            </div>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Amount in Figures <span class="required">*</span></label>
                                <div class="amount-input-wrapper">
                                    <span class="amount-prefix">NPR</span>
                                    <input type="number" class="form-input" id="chequeAmount" placeholder="0.00" step="0.01" min="0" name="cheque_amount" value="{% if edit_mode %}{{ edit_cheque.cheque_amount }}{% endif %}" required oninput="convertAmountToWords()">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Amount in Words <span class="optional">(Auto-generated)</span></label>
                                <div class="amount-words-display">
                                    <span class="label">Words:</span>
                                    <span class="placeholder" id="amountWordsText">Enter amount to see in words</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Information -->
                    <div class="form-section">
                        <div class="form-section-header">
                            <div class="form-section-icon purple">
                                <svg viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"/></svg>
                            </div>
                            <div class="form-section-title">
                                <h3>Additional Information</h3>
                                <p>Any notes or remarks for this cheque</p>
                            </div>
                        </div>

                        <div class="form-grid">
                            <div class="form-group full-width">
                                <label class="form-label">Remarks / Notes <span class="optional">(Optional)</span></label>
                                <textarea class="form-textarea" id="remarks" placeholder="Enter any additional notes... (e.g., payment for invoice #123, project name, etc.)" name="remarks">{% if edit_mode %}{{ edit_cheque.remarks }}{% endif %}</textarea>
                            </div>
                        </div>
                    </div>

                    <div class="form-footer">
                        <div class="form-footer-left">
                            {% if edit_mode %}
                            <a href="{% url 'cheque' %}" class="btn btn-ghost">
                                <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                                Cancel
                            </a>
                            {% else %}
                            <button type="button" class="btn btn-ghost" onclick="resetForm()">
                                <svg viewBox="0 0 24 24"><path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"/></svg>
                                Reset Form
                            </button>
                            {% endif %}
                        </div>
                        <div class="form-footer-right">
                            <button type="submit" class="btn btn-success btn-lg">
                                <svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
                                {% if edit_mode %}Update Cheque{% else %}Submit Cheque{% endif %}
                            </button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Recent Entries -->
            <div class="recent-entries">
                <div class="recent-entries-header">
                    <h3>
                        Recent Entries
                        <span class="count">{{ cheques.count }}</span>
                    </h3>
                    <button class="btn btn-excel" onclick="exportToExcel()">
                        <svg viewBox="0 0 24 24" width="18" height="18">
                            <path fill="currentColor" d="M21.17 3.25Q21.5 3.25 21.76 3.5 22 3.74 22 4.08V19.92Q22 20.26 21.76 20.5 21.5 20.75 21.17 20.75H7.83Q7.5 20.75 7.24 20.5 7 20.26 7 19.92V17H2.83Q2.5 17 2.24 16.76 2 16.5 2 16.17V7.83Q2 7.5 2.24 7.24 2.5 7 2.83 7H7V4.08Q7 3.74 7.24 3.5 7.5 3.25 7.83 3.25M7 13.06L8.18 15.28H9.97L8 12.06L9.93 8.89H8.22L7.13 10.9L7.09 10.96L7.06 11.03Q6.8 10.5 6.5 9.96 6.25 9.43 5.97 8.89H4.16L6.05 12.08L4 15.28H5.78M13.88 19.5V17H8.25V19.5M13.88 15.75V12.63H12V15.75M13.88 11.38V8.25H12V11.38M13.88 7V4.5H8.25V7M20.75 19.5V17H15.13V19.5M20.75 15.75V12.63H15.13V15.75M20.75 11.38V8.25H15.13V11.38M20.75 7V4.5H15.13V7Z"/>
                        </svg>
                        Export to Excel
                    </button>
                </div>
                <div class="table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Cheque No.</th>
                                <th>From (Drawer)</th>
                                <th>To (Payee)</th>
                                <th>Bank</th>
                                <th>Amount</th>
                                <th>Cheque Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if cheques %}
                                {% for cheque in cheques %}
                                <tr>
                                    <td class="table-cheque-no">{{ cheque.cheque_number }}</td>
                                    <td class="table-party">
                                        <div class="table-party-label">Drawer</div>
                                        <div class="table-party-name" title="{{ cheque.account_name }}">{{ cheque.account_name }}</div>
                                    </td>
                                    <td class="table-party">
                                        <div class="table-party-label">Payee</div>
                                        <div class="table-party-name" title="{{ cheque.payee_name }}">{{ cheque.payee_name|default:"-" }}</div>
                                    </td>
                                    <td>{{ cheque.cheque_bank }}</td>
                                    <td class="table-amount">NPR {{ cheque.cheque_amount|floatformat:2 }}</td>
                                    <td class="table-date">{{ cheque.cheque_date}}</td>
                                    <td>
                                        <span class="table-status pending">
                                            <span class="table-status-dot"></span>
                                            Pending
                                        </span>
                                    </td>
                                    <td>
                                        <div class="table-actions">
                                            <a href="{% url 'cheque_edit' cheque.id %}" class="table-action-btn edit" title="Edit">
                                                <svg viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
                                            </a>
                                            <form method="POST" action="{% url 'cheque_delete' cheque.id %}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete cheque #{{ cheque.cheque_number }}?');">
                                                {% csrf_token %}
                                                <button type="submit" class="table-action-btn delete-btn" title="Delete">
                                                    <svg viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="8" style="text-align: center; padding: 40px; color: var(--text-muted);">
                                        No cheque entries yet. Submit your first cheque above.
                                    </td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script>
        // ==================== NUMBER TO WORDS ====================
        
        const ones = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine', 'Ten',
                      'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 
                      'Eighteen', 'Nineteen'];
        const tens = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];

        function numberToWords(num) {
            if (num === 0) return 'Zero';
            if (num < 0) return 'Negative ' + numberToWords(Math.abs(num));

            let words = '';

            if (Math.floor(num / 10000000) > 0) {
                words += numberToWords(Math.floor(num / 10000000)) + ' Crore ';
                num %= 10000000;
            }

            if (Math.floor(num / 100000) > 0) {
                words += numberToWords(Math.floor(num / 100000)) + ' Lakh ';
                num %= 100000;
            }

            if (Math.floor(num / 1000) > 0) {
                words += numberToWords(Math.floor(num / 1000)) + ' Thousand ';
                num %= 1000;
            }

            if (Math.floor(num / 100) > 0) {
                words += ones[Math.floor(num / 100)] + ' Hundred ';
                num %= 100;
            }

            if (num > 0) {
                if (num < 20) {
                    words += ones[num];
                } else {
                    words += tens[Math.floor(num / 10)];
                    if (num % 10 > 0) {
                        words += ' ' + ones[num % 10];
                    }
                }
            }

            return words.trim();
        }

        function convertAmountToWords() {
            const amountInput = document.getElementById('chequeAmount');
            const wordsDisplay = document.getElementById('amountWordsText');
            const amount = parseFloat(amountInput.value);

            if (isNaN(amount) || amount <= 0) {
                wordsDisplay.textContent = 'Enter amount to see in words';
                wordsDisplay.className = 'placeholder';
                return;
            }

            const rupees = Math.floor(amount);
            const paisa = Math.round((amount - rupees) * 100);

            let words = 'Rupees ' + numberToWords(rupees);

            if (paisa > 0) {
                words += ' and ' + numberToWords(paisa) + ' Paisa';
            }

            words += ' Only';

            wordsDisplay.textContent = words;
            wordsDisplay.className = 'words';
        }

        // ==================== TRANSFER PREVIEW ====================

        function updateTransferPreview() {
            const drawer = document.getElementById('accountName').value.trim();
            const payee = document.getElementById('payeeName').value.trim();
            const previewBox = document.getElementById('transferInfoBox');
            
            if (drawer || payee) {
                previewBox.style.display = 'block';
                document.getElementById('previewDrawer').textContent = drawer || '-';
                document.getElementById('previewPayee').textContent = payee || '-';
            } else {
                previewBox.style.display = 'none';
            }
        }

        // ==================== FORM OPERATIONS ====================

        function setDefaultDates() {
            const today = new Date().toISOString().split('T')[0];
            const dateInput = document.getElementById('chequeDate');
            if (!dateInput.value) {
                dateInput.value = today;
            }
        }

        function resetForm() {
            document.getElementById('chequeForm').reset();
            document.getElementById('amountWordsText').textContent = 'Enter amount to see in words';
            document.getElementById('amountWordsText').className = 'placeholder';
            document.getElementById('transferInfoBox').style.display = 'none';
            setDefaultDates();
        }

        // ==================== EXPORT TO EXCEL ====================

        function exportToExcel() {
            const table = document.querySelector('.data-table');
            const rows = table.querySelectorAll('tbody tr');
            
            if (rows.length === 1 && rows[0].querySelector('td[colspan]')) {
                alert('No data to export');
                return;
            }

            const excelData = [];
            
            // Headers
            const headers = Array.from(table.querySelectorAll('thead th')).slice(0, -1).map(th => th.textContent.trim());
            excelData.push(headers);
            
            // Data rows
            rows.forEach(row => {
                if (!row.querySelector('td[colspan]')) {
                    const rowData = [];
                    const cells = row.querySelectorAll('td');
                    cells.forEach((td, index) => {
                        if (index < cells.length - 1) { // Exclude Actions column
                            if (index === 1 || index === 2) { // Drawer and Payee columns
                                const name = td.querySelector('.table-party-name');
                                rowData.push(name ? name.textContent.trim() : '-');
                            } else if (index === 6) { // Status column
                                const status = td.querySelector('.table-status');
                                rowData.push(status ? status.textContent.trim() : '-');
                            } else {
                                rowData.push(td.textContent.trim());
                            }
                        }
                    });
                    excelData.push(rowData);
                }
            });

            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(excelData);

            ws['!cols'] = [
                { wch: 18 }, { wch: 25 }, { wch: 25 },
                { wch: 20 }, { wch: 15 }, { wch: 15 }, { wch: 12 }
            ];

            XLSX.utils.book_append_sheet(wb, ws, 'Cheque Records');

            const today = new Date();
            const dateStr = today.toISOString().split('T')[0];
            const filename = `Cheque_Records_${dateStr}.xlsx`;

            XLSX.writeFile(wb, filename);
        }

        // ==================== THEME TOGGLE ====================

        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            body.setAttribute('data-theme', currentTheme === 'dark' ? '' : 'dark');
            localStorage.setItem('theme', currentTheme === 'dark' ? 'light' : 'dark');
        }

        // ==================== TIME UPDATE ====================

        function updateTime() {
            const now = new Date();
            const timeOptions = { hour: '2-digit', minute: '2-digit', hour12: true };
            const dateOptions = { weekday: 'short', month: 'short', day: 'numeric' };
            
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('en-US', timeOptions);
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', dateOptions);
            document.getElementById('formTime').textContent = now.toLocaleTimeString('en-US', timeOptions);
        }

        // ==================== INITIALIZE ====================

        window.addEventListener('load', () => {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
            }

            setDefaultDates();
            updateTime();
            setInterval(updateTime, 1000);

            // Convert amount to words if in edit mode
            convertAmountToWords();

            // Add input listeners for transfer preview
            document.getElementById('accountName').addEventListener('input', updateTransferPreview);
            document.getElementById('payeeName').addEventListener('input', updateTransferPreview);
        });
    </script>
</body>
</html>